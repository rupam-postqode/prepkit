# Breadcrumb Migration Guide

This guide outlines the specific steps to migrate from manual breadcrumb implementation to the centralized breadcrumb system.

## Files to Modify

### 1. Remove Manual Breadcrumb Code from Pages

#### `app/(dashboard)/learning-paths/[pathId]/page.tsx`

**Remove these lines:**
```typescript
// Lines 116-125
useEffect(() => {
  if (pathData) {
    setBreadcrumbs([
      { label: "Dashboard", href: "/dashboard" },
      { label: "Learning Paths", href: "/learning-paths" },
      { label: pathData.title, isActive: true }
    ]);
    setCurrentPage(`Learning Path: ${pathData.title}`);
  }
}, [pathData, setBreadcrumbs, setCurrentPage]);
```

**Remove these imports:**
```typescript
import { useNavigation } from "@/components/providers/navigation-provider";
```

**Remove these variable assignments:**
```typescript
const { setBreadcrumbs, setCurrentPage } = useNavigation();
```

#### `app/(dashboard)/lessons/[lessonId]/page.tsx`

**Remove these lines:**
```typescript
// Lines 112-116
<nav className="flex items-center space-x-2 text-sm text-gray-500 mb-1">
  <span>{lesson.chapter.module.title}</span>
  <span>/</span>
  <span>{lesson.chapter.title}</span>
</nav>
```

**Replace with:**
```typescript
// The breadcrumb will be automatically generated by the centralized system
// No manual navigation needed here
```

#### `app/(dashboard)/admin/learning-paths/[pathId]/schedule/page.tsx`

**Remove these lines:**
```typescript
// Lines 195-201 (Back button section)
<div className="flex items-center space-x-4">
  <Link href="/admin/learning-paths">
    <Button variant="outline" size="sm">
      <ArrowLeft className="w-4 h-4 mr-2" />
      Back
    </Button>
  </Link>
  // ... rest of the header
</div>
```

**Replace with:**
```typescript
// Breadcrumb will provide navigation, so we can simplify the header
<div className="mb-8">
  <div className="flex items-center justify-between mb-6">
    <div>
      <h1 className="text-3xl font-bold text-gray-900 flex items-center">
        <span className="mr-3">{pathData.emoji}</span>
        {pathData.title}
      </h1>
      <p className="text-gray-600">Schedule lessons across {pathData.durationWeeks} weeks</p>
    </div>
    // ... rest of the controls
  </div>
</div>
```

#### `app/(dashboard)/admin/modules/page.tsx`

**Remove these lines:**
```typescript
// Lines 197-207 (Back button section)
<div className="flex items-center space-x-3">
  <Button
    variant="ghost"
    size="sm"
    onClick={() => router.push("/admin")}
    className="text-muted-foreground hover:text-foreground"
  >
    <ChevronLeft className="w-4 h-4 mr-2" />
    Back to Admin
  </Button>
</div>
```

### 2. Update Provider Registration

#### `app/providers.tsx` (or create if it doesn't exist)

```typescript
"use client";

import { SessionProvider } from "next-auth/react";
import { NavigationProvider } from "@/components/providers/navigation-provider";

export function Providers({ children }: { children: React.ReactNode }) {
  return (
    <SessionProvider>
      <NavigationProvider>
        {children}
      </NavigationProvider>
    </SessionProvider>
  );
}
```

#### `app/layout.tsx`

Ensure the providers are used:

```typescript
import { Providers } from "./providers";

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <body>
        <Providers>
          {children}
        </Providers>
      </body>
    </html>
  );
}
```

### 3. Create New API Endpoints

#### `app/api/lessons/[lessonId]/breadcrumb/route.ts`

Create this new file to support dynamic breadcrumb data:

```typescript
import { NextRequest, NextResponse } from "next/server";
import { getServerSession } from "next-auth";
import { authOptions } from "@/lib/auth";
import { prisma } from "@/lib/db";

export async function GET(
  request: NextRequest,
  { params }: { params: { lessonId: string } }
) {
  try {
    const session = await getServerSession(authOptions);
    if (!session?.user?.id) {
      return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
    }

    const { lessonId } = await params;

    const lesson = await prisma.lesson.findUnique({
      where: { id: lessonId },
      select: {
        id: true,
        title: true,
        chapter: {
          select: {
            title: true,
            module: {
              select: {
                title: true,
              },
            },
          },
        },
      },
    });

    if (!lesson) {
      return NextResponse.json({ error: "Lesson not found" }, { status: 404 });
    }

    return NextResponse.json({
      title: lesson.title,
      chapterTitle: lesson.chapter.title,
      moduleTitle: lesson.chapter.module.title,
    });
  } catch (error) {
    console.error("Breadcrumb API error:", error);
    return NextResponse.json(
      { error: "Internal server error" },
      { status: 500 }
    );
  }
}
```

## Migration Checklist

### Phase 1: Setup Infrastructure
- [ ] Create `lib/breadcrumb-config.ts` with route configurations
- [ ] Create `lib/breadcrumb-generator.ts` with data fetching logic
- [ ] Update `components/providers/navigation-provider.tsx` with enhanced functionality
- [ ] Update `components/ui/breadcrumb.tsx` to work with new system
- [ ] Create new API endpoint for lesson breadcrumb data
- [ ] Update provider registration in app layout

### Phase 2: Remove Manual Implementations
- [ ] Remove manual breadcrumbs from `app/(dashboard)/learning-paths/[pathId]/page.tsx`
- [ ] Remove manual breadcrumbs from `app/(dashboard)/lessons/[lessonId]/page.tsx`
- [ ] Remove manual breadcrumbs from `app/(dashboard)/admin/learning-paths/[pathId]/schedule/page.tsx`
- [ ] Remove manual breadcrumbs from `app/(dashboard)/admin/modules/page.tsx`
- [ ] Check for any other pages with manual breadcrumb implementations

### Phase 3: Testing and Validation
- [ ] Test dashboard route (`/dashboard`)
- [ ] Test learning paths list (`/learning-paths`)
- [ ] Test individual learning path (`/learning-paths/[pathId]`)
- [ ] Test lesson pages (`/lessons/[lessonId]`)
- [ ] Test admin routes (`/admin`, `/admin/modules`, etc.)
- [ ] Test profile routes (`/profile`, `/profile/payment-history`)
- [ ] Test error handling and fallback behavior
- [ ] Test loading states

### Phase 4: Cleanup
- [ ] Remove unused imports from migrated pages
- [ ] Remove any unused navigation-related state variables
- [ ] Add comments to code explaining the automatic breadcrumb system
- [ ] Update any documentation that references manual breadcrumb implementation

## Testing Scenarios

### 1. Basic Functionality Tests
- Navigate to `/dashboard` - should show "Dashboard"
- Navigate to `/learning-paths` - should show "Dashboard > Learning Paths"
- Navigate to `/learning-paths/[id]` - should show "Dashboard > Learning Paths > [Path Name]"

### 2. Dynamic Data Tests
- Navigate to `/lessons/[id]` - should fetch and show module, chapter, and lesson names
- Navigate to `/admin/modules/[id]` - should fetch and show module name
- Navigate to `/admin/learning-paths/[id]/schedule` - should show path name in breadcrumbs

### 3. Error Handling Tests
- Navigate to invalid route - should show fallback breadcrumbs
- Test with network issues - should handle gracefully
- Test with missing data - should use parameter names as fallback

### 4. Performance Tests
- Navigate between routes - should use cached data when available
- Test rapid navigation - should not cause unnecessary API calls
- Test memory usage - cache should not grow indefinitely

## Rollback Plan

If issues arise during migration:

1. **Immediate Rollback**: Restore the original `useNavigation` calls in pages
2. **Partial Rollback**: Keep the new system but add manual overrides for problematic routes
3. **Gradual Migration**: Migrate routes one by one instead of all at once

## Success Criteria

The migration is successful when:

1. All existing breadcrumb functionality works automatically
2. No manual breadcrumb code remains in pages
3. Dynamic data is fetched and displayed correctly
4. Loading states and error handling work properly
5. Performance is maintained or improved
6. The system is maintainable and easy to extend

## Post-Migration Benefits

After successful migration:

1. **Developer Experience**: New pages automatically get breadcrumbs
2. **Consistency**: Uniform breadcrumb behavior across the app
3. **Maintainability**: Single source of truth for breadcrumb logic
4. **Performance**: Intelligent caching and data fetching
5. **Flexibility**: Easy to customize and extend for new routes